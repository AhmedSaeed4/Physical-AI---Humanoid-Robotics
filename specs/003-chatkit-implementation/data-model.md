# Data Model: ChatKit Implementation for Docusaurus RAG Chatbot

## Entities

### ChatThread
- **id**: string (unique identifier generated by ChatKit store)
- **created_at**: datetime (timestamp when thread was created)
- **metadata**: dict (additional thread information including user context)

**Validation rules**:
- ID must be unique across all threads
- created_at is set automatically on creation

**Relationships**:
- Contains multiple ChatMessage entities
- Associated with one user (via session/auth)

### ChatMessage
- **id**: string (unique identifier for message)
- **thread_id**: string (reference to parent ChatThread)
- **role**: string (either "user" or "assistant")
- **content**: string (message text content)
- **created_at**: datetime (timestamp when message was created)
- **context_chunks**: array of ContextChunk (relevant chunks from RAG retrieval)
- **sources**: array of Source (document sources referenced)

**Validation rules**:
- role must be either "user" or "assistant"
- thread_id must reference an existing ChatThread
- content must not be empty

**State transitions**:
- Created when user submits query or system generates response
- Updated when message content is modified (rare)

### ContextChunk
- **id**: string (unique identifier for the chunk)
- **text**: string (content of the retrieved text chunk)
- **filename**: string (source document filename)
- **chunk_number**: integer (position of chunk in document)
- **total_chunks**: integer (total number of chunks in document)
- **score**: float (relevance score from vector search)

**Validation rules**:
- score must be between 0 and 1
- chunk_number must be positive and <= total_chunks
- text must not be empty

**Relationships**:
- Associated with one ChatMessage
- Retrieved from Qdrant vector database

### Source
- **filename**: string (name of source document)
- **url**: string (URL path to source document)

**Validation rules**:
- filename must not be empty
- url must be a valid path format

**Relationships**:
- Associated with one or more ContextChunk entities
- Links to original documentation in Docusaurus site

## API Data Flow

### Request Flow
1. User submits message through ChatKit UI
2. ChatKit sends request to backend endpoint
3. Backend processes request and calls RAG pipeline
4. RAG retrieves relevant ContextChunks from Qdrant
5. Agent generates response using context
6. Response with ContextChunks and Sources returned to ChatKit

### Response Composition
- Assistant message contains generated response text
- ContextChunks array with relevant document snippets
- Sources array with document references
- All data structured for ChatKit consumption